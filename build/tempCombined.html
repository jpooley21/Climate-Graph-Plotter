<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Climate Tool</title>
    <link rel="stylesheet" href="css/style.css">
    <script src = "https://d3js.org/d3.v4.js"></script>
    <script src="https://npmcdn.com/simple-statistics@2.0.0-beta3/dist/simple-statistics.min.js"></script>
</head>
<body class = "min-h-screen bg-slate-50 dark:bg-black dark:text-white">
    <header class = "bg-teal-700 text-white sticky top-0 z-10">
       <section class="max-w-4xl mx-auto p-4 flex justify-between items-center">
            <h1 class="text-3xl font-medium">
                <a>
                    The Climate Tool
                </a>
            </h1>

            <div>
                <button id="mobile-open-button" class="text-3xl sm:hidden focus:outline-none">
                    &#9776;
                </button>
                <nav class="hidden sm:block space-x-8 text-xl" aria-label="main">
                    <a href="index.html" class="link hover:opacity-90">Home</a>
                    <a href="temperature.html" class="link hover:opacity-90">Temp</a>
                    <a href="tempCombined.html" class="link hover:opacity-90">TempSeries</a>
                    <a href="c02.html" class="link hover:opacity-90">C02</a>
                    <a href="seaice.html" class="link hover:opacity-90">Sea Ice</a>
                    <!-- <a href="#sources" class="link hover:opacity-90">Sources</a>
                    <a href="#contact" class="link hover:opacity-90">Contact </a> -->
                </nav>
            </div>
       </section> 
    </header>
    
    <main class="max-w-4xl mx-auto">
      
      <!-- <label for="datasets" class="p-1 block mb-2 text-sm font-medium text-gray-900 dark:text-white">Data source</label>
        <select id="dataSets" onchange = "dataChange()" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
          <option selected>--Choose data source--</option>
          <option value="1">CRUTEM5</option>
          <option value="2">HADCRUT5</option>
          <option value="3">GISTEMP</option>
        </select>

      

      <label for="processSteps" class="p-1 block mb-2 text-sm font-medium text-gray-900 dark:text-white">Processing steps</label>
        <select id="processSteps" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-40 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
          <option selected>--</option>
          <option value="LT">Linear trend</option>
          <option value="AV">Average</option>
          <option value="NM">Normalise</option>
        </select> -->

      
        
        <p id = "demo" class = "p-1"></p>
        <div id="chart"></div>

        

        <script>

            var data = d3.json("dataSets/data.json", function(d) {
              console.log(d);
            });

            var data = "dataSets/data.json";

            
            
            // [
            //   {
            //     name:"CRUTEM5",
            //     values: [
            //       {date: "2000", anomaly: "0.46"},
            //       {date: "2001", anomaly: "0.66"},
            //       {date: "2002", anomaly: "0.76"}

            //     ]
            //   },
            //   {
            //     name: "GISTEMP4",
            //     values: [
            //       {date: "2000", anomaly: "0.39"},
            //       {date: "2001", anomaly: "0.53"},
            //       {date: "2002", anomaly: "0.63"}
            //     ]
            //   },
            //   {
            //     name: "HADRUT5",
            //     values: [
            //       {date: "2000", anomaly: "0.33"},
            //       {date: "2001", anomaly: "0.48"},
            //       {date: "2002", anomaly: "0.54"}
              
            //     ]
            //   }
            // ];

            var width = 800;
            var height = 600;
            var margin = 50;
            var duration = 100;

            var lineOpacity = "0.25";
            var lineOpacityHover = "0.85";
            var otherLinesOpacityHover = "0.1";
            var lineStroke = "1.5px";
            var lineStrokeHover = "2.5px";

            var circleOpacity = '0.85';
            var circleOpacityOnLineHover = "0.25"
            var circleRadius = 3;
            var circleRadiusHover = 6;


            // Format Data 
            d3.json("dataSets/data.json", function(data){
              
            

            var parseDate = d3.timeParse("%Y");
            data.forEach(function(d) {
              d.values.forEach(function(d) {
                d.date = parseDate(d.date);
                d.anomaly = +d.anomaly;
              });
            });

            

            // Scale
            var xScale = d3.scaleTime()
              .domain(d3.extent(data[0].values, d => d.date))
              .range([0, width-margin]);

            var yScale = d3.scaleLinear()
              .domain([-1, d3.max(data[0].values, d => d.anomaly)])
              .range([height-margin, 0]);

            var color = d3.scaleOrdinal(d3.schemeCategory10);

            var svg = d3.select("#chart").append("svg")
              .attr("width", (width+margin)+"px")
              .attr("height", (height+margin)+"px")
              .append('g')
              .attr("transform", `translate(${margin}, ${margin})`);

            // Add line into svg
            var line = d3.line()
              .x(d => xScale(d.date))
              .y(d => yScale(d.anomaly));
            
            
            let lines = svg.append('g')
              .attr('class', 'lines');

            lines.selectAll('.line-group')
              .data(data).enter()
              .append('g')
              .attr('class', 'line-group')
              .on("mouseover", function(d,i){
                svg.append("text")
                  .attr("class", "title-text")
                  .style("fill",color(i))
                  .text(d.name)
                  .attr("text-anchor", "middle")
                  .attr("x", (width-margin)/2)
                  .attr("y",5);
              })
            .on("mouseout",function(d){
              svg.select(".title-text").remove();
            })

            

            .append('path')
            .attr('class','line')
            .attr('d', d => line(d.values))
            .style('stroke', (d,i) => color(i))
            .style('opacity', lineOpacity)
            .on("mouseover", function(d){
                d3.selectAll('.line')
                  .style('opacity', otherLinesOpacityHover);
                d3.selectAll('.circle')
                  .style('opacity', circleOpacityOnLineHover);
                d3.select(this)
                  .style('opacity', lineOpacityHover)
                  .style("stroke-width", lineStrokeHover)
                  .style("cursor", "pointer");
            })
            .on("mouseout", function(d) {
              d3.selectAll(".line")
                .style('opacity', lineOpacity);
              d3.selectAll('.circle')
                .style('opacity', circleOpacity);
              d3.select(this)
                .style("stroke-width", lineStroke)
                .style("cursor", "none");
            });

            // Add circles in the line
            lines.selectAll("circle-group")
              .data(data).enter()
              .append("g")
              .style("fill", (d, i) => color(i))
              .selectAll("circle")
              .data(d => d.values).enter()
              .append("g")
              .attr("class", "circle")
              .on("mouseover", function(d){
                d3.select(this)
                  .style("cursor", "pointer")
                  .append("text")
                  .attr("class", "text")
                  .text(`${d.anomaly}`)
                  .attr("x", d => xScale(d.date)+5)
                  .attr("y", d => yScale(d.anomaly) -10);
              })
            .on("mouseout", function(d) {
              d3.select(this)
                .style("cursor", "none")
                .transition()
                .duration(duration)
                .selectAll(".text").remove();
            })  
            .append("circle")
            .attr("cx", d => xScale(d.date))
            .attr("cy", d => yScale(d.anomaly))
            .attr("r", circleRadius)
            .style('opacity', circleOpacity)
            .on("mouseover", function(d) {
              d3.select()
                .transition()
                .duration(duration)
                .attr("r", circleRadiusHover);
            
            })

            .on("mouseout", function(d) {
              d3.select(this)
                .transition()
                .duration(duration)
                .attr("r", circleRadius);
            });

          
          
          // Add axis into SVG
          var xAxis = d3.axisBottom(xScale).ticks(5);
          var yAxis = d3.axisLeft(yScale).ticks(5);

          
          

          svg.append("g")
            .attr("class", "x axis")
            .attr("transform", `translate(0, ${height-margin})`)
            .call(xAxis);
          
          svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
            .append('text')
            .attr("y",15)
            .attr("fill", "#000")
            .text("Temp Anomaly");

          

            })
              
          
            
            </script>



    </main>
    
</body>
</html>